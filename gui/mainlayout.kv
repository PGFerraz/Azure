#:import FitImage kivymd.uix.fitimage.FitImage

<MainLayout>:
    orientation: "vertical"

    # Gerenciador de Telas/Menus
    MDScreenManager:
        id: screen_manager
        # Add this before your other MDScreens inside MDScreenManager

        MDScreen:
            name: "screen_login"

            #Layout Principal
            MDFloatLayout:
                md_bg_color: 0.122, 0.122, 0.145

                # Linha Azul em cima da barra de navegação
                Widget:
                    size_hint: None, None
                    size: root.width, dp(6)
                    pos: 0, 0
                    canvas:
                        Color:
                            rgba: 0.247,0.576,0.604,1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                
                # Imagem da Logo
                Image:
                    source: root._imgLogoAzure
                    size_hint: 0.55, 0.35
                    pos_hint: {"center_x": 0.5, "top": 0.95}

                # Caixa de texto - Nome de Usuário
                MDTextField:
                    id: username
                    mode: "filled"
                    size_hint_x: 0.7
                    pos_hint: {"center_x": 0.5, "top": 0.62}

                    MDTextFieldLeadingIcon:
                        icon: "account-edit"

                    MDTextFieldHintText:
                        text: "Inserir Nome de Usuário"
                        text_color_normal: "white"

                    MDTextFieldHelperText:
                        text: "max 10 caracteres"
                        mode: "persistent"

                    MDTextFieldMaxLengthText:
                        max_text_length: 10

                # Caixa de texto - Senha
                MDTextField:
                    id: password
                    mode: "filled"
                    size_hint_x: 0.7
                    pos_hint: {"center_x": 0.5, "top": 0.47}
                    password: True

                    MDTextFieldLeadingIcon:
                        icon: "key"

                    MDTextFieldHintText:
                        text: "Inserir Senha"
                        text_color_normal: "white"

                    MDTextFieldHelperText:
                        text: "min 8 caracteres, letras e números"
                        mode: "persistent"

                    MDTextFieldMaxLengthText:
                        max_text_length: 10
                
                # Checkbox
                MDCheckbox:
                    size_hint: None, None
                    size: "48dp", "48dp"
                    pos_hint: {"center_x": 0.2, "top": 0.33}
                    on_active: root.show_password(*args)
                
                # Texto "Mostrar/Ocultar" Senha
                MDLabel:
                    id: password_text
                    text: "Mostrar Senha"
                    pos_hint: {"center_x": 0.4, "top": 0.336}
                    size_hint: 0.3, 0.05
                    theme_text_color: "Custom"
                    text_color: 1, 1, 1, 1

                # Login Status
                MDLabel:
                    id: login_status
                    text: ""
                    pos_hint: {"center_x": 0.58, "top": 0.68}
                    size_hint: 0.80, 0.05
                    theme_text_color: "Custom"
                    text_color: 0.247,0.576,0.604,1
                    font_size: "12sp"


                # Botão "Cadastrar"
                MDButton:
                    style: "filled"
                    pos_hint: {"center_x": 0.5, "top": 0.25}
                    size_hint: None, None
                    size: "386dp", "50dp"

                    theme_bg_color: "Custom"
                    md_bg_color: 0.247,0.576,0.604,1
                    on_release: root.user_registration()
                    MDButtonText:
                        text: "Cadastrar"
                        font_style: "Title"
                        theme_font_size: "Custom"
                        font_size: "16sp" 
                        theme_text_color: "Custom"
                        text_color: "white"
                
                # Botão "Log-In"
                MDButton:
                    style: "filled"
                    pos_hint: {"center_x": 0.5, "top": 0.15}
                    size_hint: None, None
                    size: "386dp", "50dp"

                    theme_bg_color: "Custom"
                    md_bg_color: 0.247,0.576,0.604,1
                    on_release: root.user_login()
                    MDButtonText:
                        text: "Log-In"
                        font_style: "Title"
                        theme_font_size: "Custom"
                        font_size: "16sp" 
                        theme_text_color: "Custom"
                        text_color: "white"

        # Tela de Guias
        MDScreen:
            name: "screen_guides"

            MDLabel:
                text: "Guias e tutoriais"
                halign: "center"

        # Tela Principal/Home
        MDScreen:
            name: "screen_home"

            # Layout Principal
            MDFloatLayout:
                md_bg_color: 0.122, 0.122, 0.145

                # Linha Azul em cima da barra de navegação
                Widget:
                    size_hint: None, None
                    size: root.width, dp(6)
                    pos: 0, 0
                    canvas:
                        Color:
                            rgba: 0.247,0.576,0.604,1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                MDLabel: 
                    text: "Primeiros Passos"
                    halign: "center"
                    pos_hint: {'center_x':0.18, 'top':1.29}
                    theme_text_color: "Custom"
                    text_color: 1, 1, 1, 1

                # Linha ao lado dos "Primeiros Passos"
                Widget:
                    size_hint: None, None
                    size: self.parent.width, dp(2)   
                    pos: 0, self.parent.height - dp(155) 
                    
                    canvas:
                        Color:
                            rgba: 0, 0.6, 1, 1
                        Line:
                            points: [self.parent.width*0.35, self.y, self.parent.width*1.01, self.y]  
                            width: 1
                
                # Botão de criar seu Perfil
                MDButton:
                    style: "filled"
                    theme_width: "Custom"
                    height: "60dp"
                    size_hint_x: .4
                    pos_hint: {'center_x':0.26, 'top':0.75}
                    on_release: screen_manager.current = "screen_reg_profile"

                    MDButtonIcon:
                        icon: "account"

                    MDButtonText:
                        text: "Criando o seu \nPerfil"
                        the_font_size: "custom"
                        font_size: "8sp"

                # Botão Atalho para os Guias
                MDButton:
                    style: "filled"
                    theme_width: "Custom"
                    height: "60dp"
                    size_hint_x: .4
                    pos_hint: {'center_x':0.74, 'top':0.75}

                    MDButtonIcon:
                        x: text.x - (self.width + dp(8))
                        icon: "book"

                    MDButtonText:
                        id: text
                        text: "Guias e \nTutoriais"
                        pos_hint: {"center_x": .5, "center_y": .5}
                
                # Área de Notícias
                MDLabel: 
                    text: "Fique por Dentro"
                    halign: "center"
                    pos_hint: {'center_x':0.18, 'top':1.08}
                    theme_text_color: "Custom"
                    text_color: 1, 1, 1, 1

                # Linha que Separa a Seção de Notícias
                Widget:
                    size_hint: None, None
                    size: self.parent.width, dp(2)   
                    pos: 0, self.parent.height - dp(310) 
                    
                    canvas:
                        Color:
                            rgba: 0, 0.6, 1, 1
                        Line:
                            points: [self.parent.width*0.35, self.y, self.parent.width*1.01, self.y]  
                            width: 1
                
                # Botão de configurações
                MDIconButton:
                    icon: "cog"
                    style: "standard"
                    size_hint: 0.15, 0.08
                    pos_hint: {"center_x": 0.86, "top": 0.94}
                    theme_bg_color: "Custom"
                    md_bg_color: 0.122, 0.122, 0.145
                    theme_icon_color: "Custom"
                    icon_color: "white"

                # Botão de Notificações
                MDIconButton:
                    icon: "bell"
                    style: "standard"
                    size_hint: 0.15, 0.08
                    pos_hint: {"center_x": 0.70, "top": 0.94}
                    theme_bg_color: "Custom"
                    md_bg_color: 0.122, 0.122, 0.145
                    theme_icon_color: "Custom"
                    icon_color: "white"

        # Tela de Perfil
        MDScreen:
            name: "screen_profile"

            # Layout Principal
            MDFloatLayout:
                md_bg_color: 0.122, 0.122, 0.145
                
                # Linha Azul em cima da barra de navegação
                Widget:
                    size_hint: None, None
                    size: root.width, dp(6)
                    pos: 0, 0
                    canvas:
                        Color:
                            rgba: 0.247,0.576,0.604,1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                
                # Linha Horizontal do texto "Diário"
                Widget:
                    size_hint: None, None
                    size: self.parent.width, dp(2)
                    pos: 0, self.parent.height - dp(147)
                    
                    canvas:
                        Color:
                            rgba: 0.247,0.576,0.604,1
                        Line:
                            points: [self.parent.width*0.25, self.y, self.parent.width*1.01, self.y]
                            width: 1
                
                # Linha Horizontal do texto "Mensal"
                Widget:
                    size_hint: None, None
                    size: self.parent.width, dp(2)
                    pos: 0, self.parent.height - dp(412)
                    
                    canvas:
                        Color:
                            rgba: 0.247,0.576,0.604,1
                        Line:
                            points: [self.parent.width*0.29, self.y, self.parent.width*1.01, self.y]
                            width: 1

                # Nome de Usuário
                MDLabel:
                    id: profile_username
                    text: "Username"
                    size_hint: 0.18, 0.13
                    pos_hint: {"center_x": 0.35, "top": 0.96}
                    theme_text_color: "Custom"
                    text_color: 1, 1, 1, 1
                
                # Texto "Diário"
                MDLabel:
                    text: "Diário"
                    size_hint: 0.20, 0.13
                    pos_hint: {"center_x": 0.16, "top": 0.87}
                    theme_text_color: "Custom"
                    text_color: 1, 1, 1, 1
                    theme_font_size: "Custom"
                    font_size: "24sp" 
                
                # Texto "Mensal"
                MDLabel:
                    text: "Mensal"
                    size_hint: 0.20, 0.13
                    pos_hint: {"center_x": 0.16, "top": 0.525}
                    theme_text_color: "Custom"
                    text_color: 1, 1, 1, 1
                    theme_font_size: "Custom"
                    font_size: "24sp" 

                # Imagem de Perfil
                Image:
                    source: root._imgDefaultAvatar
                    size_hint: 0.18, 0.13
                    pos_hint: {"center_x": 0.14, "top": 0.96}

                # Botão de Log-Out
                MDIconButton:
                    icon: "account-remove"
                    pos_hint: {"center_x": 0.86, "top": 0.93}
                    theme_icon_color: "Custom"
                    icon_color: "white"
                    on_release: root.logout_user()

                # Botão de Notificações
                MDIconButton:
                    icon: "bell"
                    pos_hint: {"center_x": 0.70, "top": 0.93}
                    theme_icon_color: "Custom"
                    icon_color: "white"

                # Gráfico Diário
                Graph:
                    id: profile_graph_day
                    size_hint: 0.88, 0.30
                    pos_hint: {"center_x": 0.5, "top": 0.785}
                    xlabel: ""
                    ylabel: "Nível (mg/dL)"
                    xmin: 6
                    xmax: 24
                    ymin: 0
                    ymax: 300
                    x_ticks_minor: 1
                    x_ticks_major: 6
                    y_ticks_major: 70
                    x_grid_label: True
                    y_grid_label: True
                    x_grid: True
                    y_grid: True
                    padding: 10
                
                # Gráfico Mensal
                Graph:
                    id: profile_graph_month
                    size_hint: 0.88, 0.30
                    pos_hint: {"center_x": 0.5, "top": 0.44}
                    xlabel: ""
                    ylabel: "Nível (mg/dL)"
                    xmin: 6
                    xmax: 24
                    ymin: 0
                    ymax: 300
                    x_ticks_minor: 1
                    x_ticks_major: 6
                    y_ticks_major: 70
                    x_grid_label: True
                    y_grid_label: True
                    x_grid: True
                    y_grid: True
                    padding: 10

                # Imagem Glicemia
                Image:
                    source: root._imgRegGlic
                    size_hint: 0.6, 0.4
                    pos_hint: {"center_x": 0.52, "top": 0.28}

                # Botão de registrar glicemia
                MDButton:
                    style: "filled"
                    pos_hint: {"center_x": 0.58, "top": 0.105}
                    size_hint: None, None
                    size: "286dp", "40dp"

                    theme_bg_color: "Custom"
                    md_bg_color: 0.247,0.576,0.604,1
                    on_release: screen_manager.current = "screen_glycemia"

                    MDButtonIcon:
                        icon: "plus"
                        theme_icon_color: "Custom"
                        icon_color: "white"


                    MDButtonText:
                        text: "Registrar Glicemia"
                        font_style: "Title"
                        theme_font_size: "Custom"
                        font_size: "14sp"
                        theme_text_color: "Custom"
                        text_color: "white"

        MDScreen:
            name: "screen_glycemia"

            #Layout Principal
            MDFloatLayout:
                md_bg_color: 0.122, 0.122, 0.145

                # Linha Azul em cima da barra de navegação
                Widget:
                    size_hint: None, None
                    size: root.width, dp(6)
                    pos: 0, 0
                    canvas:
                        Color:
                            rgba: 0.247,0.576,0.604,1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                # Caixa de texto - Nível de Glicemia
                MDTextField:
                    id: glycemia_input
                    mode: "filled"
                    size_hint_x: 0.7
                    pos_hint: {"center_x": 0.5, "top": 0.62}

                    MDTextFieldLeadingIcon:
                        icon: "account-edit"

                    MDTextFieldHintText:
                        text: "Inserir Nível de Glicemia"
                        text_color_normal: "white"

                    MDTextFieldHelperText:
                        text: "max 10 caracteres"
                        mode: "persistent"

                    MDTextFieldMaxLengthText:
                        max_text_length: 10

                # Login Status
                MDLabel:
                    id: login_status
                    text: ""
                    pos_hint: {"center_x": 0.58, "top": 0.68}
                    size_hint: 0.80, 0.05
                    theme_text_color: "Custom"
                    text_color: 0.247,0.576,0.604,1
                    font_size: "12sp"


                # Botão "Registrar"
                MDButton:
                    style: "filled"
                    pos_hint: {"center_x": 0.5, "top": 0.25}
                    size_hint: None, None
                    size: "386dp", "50dp"

                    theme_bg_color: "Custom"
                    md_bg_color: 0.247,0.576,0.604,1
                    on_release: root.register_glycemia()
                    MDButtonText:
                        text: "Cadastrar"
                        font_style: "Title"
                        theme_font_size: "Custom"
                        font_size: "16sp" 
                        theme_text_color: "Custom"
                        text_color: "white"

    MDNavigationBar:
        id: nav_bar
        opacity: 0 if screen_manager.current == "screen_login" else 1
        disabled: True if screen_manager.current == "screen_login" else False
        md_bg_color: (0.122, 0.122, 0.145, 0) if screen_manager.current == "screen_login" else (0.122, 0.122, 0.145, 1)
        height: 0 if screen_manager.current == "screen_login" else dp(56)

        MDNavigationItem:
            name: "screen_guides"
            text: "Guias"
            on_release: screen_manager.current = "screen_guides"
            indicator_color: 0.153, 0.153, 0.153, 1

            MDNavigationItemIcon:
                icon: "book"

        MDNavigationItem:
            name: "screen_home"
            text: "Início"
            on_release: screen_manager.current = "screen_home"

            MDNavigationItemIcon:
                icon: "home"

        MDNavigationItem:
            name: "screen_profile"
            text: "Perfil"
            on_release: screen_manager.current = "screen_profile"

            MDNavigationItemIcon:
                icon: "account"
